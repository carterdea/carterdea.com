---
import { ClientRouter } from 'astro:transitions';
import '../styles/global.css';
import { BackgroundRenderer } from '../components/BackgroundRenderer/BackgroundRenderer';
import { MoneyModeSection } from '../components/MoneyModeSection';
import { PreviewModeSection } from '../components/PreviewModeSection';

interface Props {
  title: string;
  description?: string;
}

const { title, description = 'Product design, AI engineering, and Shopify development focused on business outcomes. UX audits and conversion rate optimization for ecommerce and SaaS.' } = Astro.props;
const canonicalURL = new URL(Astro.url.pathname, Astro.site || 'https://carterdea.com');
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Primary Meta Tags -->
    <title>{title}</title>
    <meta name="title" content={title} />
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalURL} />

    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/svg+xml" href="/assets/logos/carterdea-icon.svg" />
    <link rel="apple-touch-icon" href="/assets/icons/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/icons/apple-touch-icon-76.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/icons/apple-touch-icon-120.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/icons/apple-touch-icon-152.png" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content="https://carterdea.com/og-image.png" />
    <meta property="og:site_name" content="Carter DeAngelis" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={canonicalURL} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content="https://carterdea.com/og-image.png" />

    <!-- Font Preload -->
    <link rel="preload" href="/assets/fonts/font.woff2" as="font" type="font/woff2" crossorigin />

    <!-- JSON-LD Structured Data -->
    <script is:inline type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "ProfessionalService",
        "name": "Carterdea",
        "url": "https://carterdea.com",
        "logo": "https://carterdea.com/assets/logos/carterdea-icon.svg",
        "image": "https://carterdea.com/og-image.png",
        "description": "Product design, AI engineering, and Shopify development focused on business outcomes. UX audits and conversion rate optimization for ecommerce and SaaS.",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Scottsdale",
          "addressRegion": "AZ",
          "addressCountry": "US"
        },
        "areaServed": [
          {"@type": "City", "name": "Los Angeles"},
          {"@type": "City", "name": "San Francisco"},
          {"@type": "City", "name": "New York"},
          {"@type": "City", "name": "Phoenix"},
          {"@type": "City", "name": "Scottsdale"},
          {"@type": "City", "name": "Denver"},
          {"@type": "City", "name": "Salt Lake City"},
          {"@type": "City", "name": "Boston"},
          {"@type": "City", "name": "Miami"},
          {"@type": "City", "name": "Orange County"},
          {"@type": "City", "name": "Dallas"},
          {"@type": "City", "name": "Austin"},
          {"@type": "Country", "name": "United States"}
        ],
        "serviceType": [
          "Product Design",
          "AI Engineering",
          "Shopify Plus Development",
          "Shopify Headless Development",
          "UX Audits",
          "Conversion Rate Optimization",
          "Front-end Development",
          "Backend Development"
        ],
        "priceRange": "$$$",
        "sameAs": [
          "https://www.linkedin.com/in/carterdea",
          "https://github.com/carterdea"
        ],
        "founder": {
          "@type": "Person",
          "name": "Carter DeAngelis",
          "jobTitle": "Founder & Principal",
          "url": "https://www.linkedin.com/in/carterdea"
        },
        "foundingDate": "2013",
        "knowsAbout": [
          "Product Design",
          "AI Engineering",
          "Shopify Development",
          "Conversion Rate Optimization",
          "UX Design",
          "React",
          "Next.js"
        ]
      }
    </script>

    <script is:inline type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "Carterdea",
        "alternateName": "Carter DeAngelis",
        "url": "https://carterdea.com",
        "description": "Product design, AI engineering, and Shopify development agency",
        "publisher": {
          "@type": "Organization",
          "name": "Carterdea",
          "url": "https://carterdea.com",
          "logo": {
            "@type": "ImageObject",
            "url": "https://carterdea.com/assets/logos/carterdea-icon.svg"
          }
        }
      }
    </script>

    <ClientRouter />
  </head>
  <body class="bg-black text-white font-sans antialiased min-h-screen overscroll-none">
    <BackgroundRenderer client:load />
    <MoneyModeSection client:load />
    <PreviewModeSection client:load />
    <slot />
  </body>
</html>

<style is:global>
  /* Subtle page transition - quick fade */
  ::view-transition-old(page-content) {
    animation: fade-out 150ms ease-out forwards;
  }

  ::view-transition-new(page-content) {
    animation: fade-in 150ms ease-in forwards;
  }

  @keyframes fade-out {
    from { opacity: 1; }
    to { opacity: 0; }
  }

  @keyframes fade-in {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  /* Instant swap for header/footer - hide old immediately */
  ::view-transition-old(header),
  ::view-transition-old(footer) {
    display: none;
  }

  ::view-transition-new(header),
  ::view-transition-new(footer) {
    animation: none;
  }
</style>
