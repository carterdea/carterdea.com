---
import Button from './ui/Button.tsx';

interface Testimonial {
  quote: string;
  author: string;
  role: string;
  company: string;
  logoSrc?: string;
}

interface Props {
  technologies?: string[];
  services?: string[];
  results?: string[];
  testimonials?: Testimonial[];
  cta?: {
    title: string;
    subtitle: string;
  };
}

const { technologies = [], services = [], results = [], testimonials = [], cta } = Astro.props;

const ChevronLeft = `<svg width="5" height="8" viewBox="0 0 5 8" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 1L1 4L4 7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
const ChevronRight = `<svg width="5" height="8" viewBox="0 0 5 8" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 1L4 4L1 7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
---

<div class="info-sections grid grid-cols-1 md:grid-cols-4 gap-16 md:gap-y-20 px-4 md:px-0 py-12 md:py-16">
  <!-- Technologies -->
  {technologies.length > 0 && (
    <>
      <h3 class="text-sm text-white tracking-[-0.28px] mb-3 md:mb-0 animate-fade-in-up" style="--delay: 300ms;">Technologies</h3>
      <p class="text-sm text-white/60 tracking-[-0.28px] leading-normal md:col-span-2 animate-fade-in-up" style="--delay: 300ms;">
        {technologies.join(', ')}
      </p>
      <div class="hidden md:block"></div>
    </>
  )}

  <!-- Services -->
  {services.length > 0 && (
    <>
      <h3 class="text-sm text-white tracking-[-0.28px] mb-3 md:mb-0 animate-fade-in-up" style="--delay: 350ms;">Services</h3>
      <p class="text-sm text-white/60 tracking-[-0.28px] leading-normal md:col-span-2 animate-fade-in-up" style="--delay: 350ms;">
        {services.join(', ')}
      </p>
      <div class="hidden md:block"></div>
    </>
  )}

  <!-- Results -->
  {results.length > 0 && (
    <>
      <h3 class="text-sm text-white tracking-[-0.28px] mb-3 md:mb-0 animate-fade-in-up" style="--delay: 400ms;">Results</h3>
      <ul class="list-disc pl-5 space-y-1 md:col-span-2 animate-fade-in-up" style="--delay: 400ms;">
        {results.map((result) => (
          <li class="text-sm text-white/60 tracking-[-0.28px] leading-normal">{result}</li>
        ))}
      </ul>
      <div class="hidden md:block"></div>
    </>
  )}

  <!-- Testimonials -->
  {testimonials.length > 0 && (
    <>
      <div class="flex items-center justify-between md:block animate-fade-in-up" style="--delay: 450ms;">
        <h3 class="text-sm text-white tracking-[-0.28px]">Testimonials</h3>
        {testimonials.length > 1 && (
          <div class="flex gap-1 md:hidden">
            <Button client:load type="button" className="testimonial-prev px-2! py-1!" aria-label="Previous testimonial">
              <Fragment set:html={ChevronLeft} />
            </Button>
            <Button client:load type="button" className="testimonial-next px-2! py-1!" aria-label="Next testimonial">
              <Fragment set:html={ChevronRight} />
            </Button>
          </div>
        )}
      </div>
      <div class="md:col-span-2 animate-fade-in-up" style="--delay: 450ms;">
        {testimonials.length > 1 && (
          <div class="hidden md:flex gap-1 justify-end mb-4">
            <Button client:load type="button" className="testimonial-prev px-2! py-1!" aria-label="Previous testimonial">
              <Fragment set:html={ChevronLeft} />
            </Button>
            <Button client:load type="button" className="testimonial-next px-2! py-1!" aria-label="Next testimonial">
              <Fragment set:html={ChevronRight} />
            </Button>
          </div>
        )}
        <div class="testimonials-container">
          {testimonials.map((testimonial, index) => (
            <div
              class:list={[
                'testimonial-slide border-l border-white pl-4',
                index === 0 ? 'block' : 'hidden'
              ]}
              data-testimonial-index={index}
            >
              <p class="text-sm text-white/60 tracking-[-0.28px] leading-normal italic mb-3 md:mb-3">
                "{testimonial.quote}"
              </p>
              <div class="flex items-center gap-2 flex-wrap">
                <span class="text-sm text-white/60 tracking-[-0.28px]">
                  â€” {testimonial.author}, {testimonial.role}
                </span>
                {testimonial.logoSrc && (
                  <img src={testimonial.logoSrc} alt={testimonial.company} class="h-6 w-auto" />
                )}
                <span class="text-sm text-white/60 tracking-[-0.28px]">{testimonial.company}</span>
              </div>
            </div>
          ))}
        </div>
      </div>
      <div class="hidden md:block"></div>
    </>
  )}

  <!-- CTA -->
  {cta && (
    <>
      <h3 class="text-sm text-white tracking-[-0.28px] mb-3 md:mb-0 animate-fade-in-up" style="--delay: 500ms;">{cta.title}</h3>
      <div class="md:col-span-2 animate-fade-in-up" style="--delay: 500ms;">
        <p class="text-sm text-white/60 tracking-[-0.28px] leading-normal mb-4">
          {cta.subtitle}
        </p>
        <Button client:load as="a" href="/contact">
          Contact Us
        </Button>
      </div>
      <div class="hidden md:block"></div>
    </>
  )}
</div>

<script is:inline>
  (function() {
    // Use event delegation for React buttons that load after this script
    let currentIndex = 0;

    const getSlides = () => document.querySelectorAll('.testimonial-slide');

    const showSlide = (index) => {
      const slides = getSlides();
      slides.forEach((slide, i) => {
        slide.classList.toggle('hidden', i !== index);
        slide.classList.toggle('block', i === index);
      });
    };

    // Event delegation on document for dynamically loaded React buttons
    document.addEventListener('click', (e) => {
      const target = e.target.closest('.testimonial-prev, .testimonial-next');
      if (!target) return;

      const slides = getSlides();
      if (slides.length <= 1) return;

      if (target.classList.contains('testimonial-prev')) {
        currentIndex = (currentIndex - 1 + slides.length) % slides.length;
      } else {
        currentIndex = (currentIndex + 1) % slides.length;
      }
      showSlide(currentIndex);
    });
  })();
</script>
